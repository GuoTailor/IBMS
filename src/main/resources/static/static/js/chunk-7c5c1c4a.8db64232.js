(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c5c1c4a"],{1875:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"b",(function(){return l})),a.d(e,"a",(function(){return o})),a.d(e,"d",(function(){return r}));var i=a("b775");function n(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return Object(i["a"])({url:"/building/list",method:"get",params:{parentId:t,page:e,size:a}})}function l(t){return Object(i["a"])({url:"/building",method:"delete",data:{id:t}})}function o(t,e,a,n){return Object(i["a"])({url:"/building",method:"post",customParam:{requestDataType:"json"},data:{parentId:t,name:e,type:a,comment:n}})}function r(t,e,a){return Object(i["a"])({url:"/building",method:"PUT",customParam:{requestDataType:"json"},data:{id:t,name:e,comment:a}})}},"4ca5":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-tree",{ref:"tree",attrs:{data:t.buildingData,props:t.props,load:t.loadNode,lazy:"","highlight-current":""},on:{"node-click":t.handleNodeClick}})],1),a("el-col",{attrs:{span:18}},[a("el-row",[a("el-col",[a("el-breadcrumb",{staticClass:"breadcrumb-box",attrs:{separator:"/"}},t._l(t.breadcrumbList,(function(e){return a("el-breadcrumb-item",{key:e},[t._v(t._s(e))])})),1)],1)],1),a("el-row",{staticClass:"search-box",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},on:{change:t.handleSearch},model:{value:t.selectValue,callback:function(e){t.selectValue=e},expression:"selectValue"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1)],1),a("el-button",{attrs:{type:"primary",disabled:3==t.selectItem.type},on:{click:t.handleCreate}},[t._v("添加"+t._s(t.typeName))])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{align:"center",label:"序号",width:"95"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.id)+" ")]}}])}),a("el-table-column",{attrs:{label:"名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.name)+" ")]}}])}),a("el-table-column",{attrs:{label:"类型",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(t.type2Name(i.type)))])]}}])}),a("el-table-column",{attrs:{label:"备注",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.comment)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",prop:"created_at",label:"创建时间",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("i",{staticClass:"el-icon-time"}),a("span",[t._v(t._s(t._f("parseTime")(i.createTime)))])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"140",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,n=e.$index;return[a("el-row",[a("el-col",{attrs:{span:12}},[a("abbr",{attrs:{title:"编辑"}},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(e){return t.handleUpdate(i)}}})],1)]),a("el-col",{attrs:{span:12}},[a("el-popconfirm",{attrs:{"confirm-button-text":"删除","cancel-button-text":"取消","confirm-button-type":"danger",icon:"el-icon-delete","icon-color":"red",title:"确定删除该条数据吗？"},on:{onConfirm:function(e){return t.handleDelete(i,n)}}},[a("abbr",{attrs:{slot:"reference",title:"删除"},slot:"reference"},[a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"}})],1)])],1)],1)]}}])})],1),a("el-pagination",{staticClass:"pagination-box",attrs:{background:"",layout:"prev, pager, next","page-size":t.pageSize,"page-count":t.page,total:t.totalCount},on:{"current-change":t.fetchData}}),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"30px"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name",e)},expression:"temp.name"}})],1),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-select",{staticClass:"filter-item",attrs:{disabled:"",placeholder:"请选择类型"},model:{value:t.temp.type,callback:function(e){t.$set(t.temp,"type",e)},expression:"temp.type"}},t._l(t.typeOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"备注名称",prop:"noteName"}},[a("el-input",{attrs:{placeholder:"请输入备注名称"},model:{value:t.temp.noteName,callback:function(e){t.$set(t.temp,"noteName",e)},expression:"temp.noteName"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v(" 取消 ")]),a("el-button",{attrs:{type:"primary",loading:t.dialogFormSobmitLoading},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData()}}},[t._v(" 保存 ")])],1)],1)],1)],1)],1)},n=[],l=(a("99af"),a("7db0"),a("fb6a"),a("a434"),a("b0c0"),a("2909")),o=a("1875"),r=a("ed08"),s={filters:{statusFilter:function(t){var e={published:"success",draft:"gray",deleted:"danger"};return e[t]},parseTime:r["b"]},computed:{typeName:function(){var t=this.selectItem.type?this.selectItem.type+1:1;return t>3&&(t=3),this.type2Name(t)},dialogTitle:function(){return"".concat("create"==this.dialogStatus?"添加":"修改").concat(this.typeName)},breadcrumbList:function(){var t=[];this.selectNode||t.push("未选择");var e=this.selectNode||{};do{e.parent&&t.unshift(e.data.name),e=e.parent}while(e&&e.parent);return t}},data:function(){return{list:null,page:1,pageSize:30,totalCount:0,listLoading:!0,dialogFormVisible:!1,dialogFormSobmitLoading:!1,selectValue:"",selectItem:{},selectNode:void 0,temp:{id:void 0,name:"",type:"",noteName:""},dialogStatus:"",typeOptions:[{label:"楼宇",value:1},{label:"楼层",value:2},{label:"房间",value:3}],rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],type:[{required:!0,message:"类型不能为空",trigger:"blur"}],noteName:[{required:!0,message:"备注名称不能为空",trigger:"blur"}]},props:{label:"name",children:"zones",isLeaf:function(t){return 3===t.type||0===t.type}},buildingData:[{name:"添加楼宇",type:0}]}},methods:{type2Name:function(t){var e=this.typeOptions.find((function(e){return e.value==t}));return e?e.label:""},handleNodeClick:function(t,e){this.selectItem.name!=t.name&&(this.selectItem=t,this.selectNode=e,this.page=1,0===t.type?this.list=this.buildingData.slice(1):3===t.type?this.list=e.parent.data.children:this.list=t.children)},getAllBuildingList:function(t){this.getSingleBuildingList(1,this.pageSize,t)},getSingleBuildingList:function(t,e,a){var i=this;Object(o["c"])(void 0,t,e).then((function(t){var n=t.code,o=t.data;t.msg;if(0===n){var r,s=o.pageNum,c=o.pages,d=o.list;(r=i.buildingData).push.apply(r,Object(l["a"])(d)),s<c?i.getSingleBuildingList(s+1,e,a):(i.listLoading=!1,i.list=i.buildingData.slice(1),a(i.buildingData))}}))},getFloorItemAllList:function(t,e){var a=this.buildingData.find((function(e){return e.id===t}));a&&a.children instanceof Array||(this.listLoading=!0,this.getSingleFloorItemAllList(t,1,this.pageSize,e))},getSingleFloorItemAllList:function(t,e,a,i){var n=this;Object(o["c"])(t,e,a).then((function(e){var o=e.code,r=e.data;e.msg;if(0===o){var s,c=r.pageNum,d=r.pages,u=r.list,m=n.buildingData.find((function(e){return e.id==t})),p=m.children;p||(p=[],n.$set(m,"children",p)),(s=p).push.apply(s,Object(l["a"])(u)),c<d?n.getSingleFloorItemAllList(t,c+1,a,i):(n.listLoading=!1,i(p),n.list=p)}}))},getRoomItemAllList:function(t,e,a){for(var i=0;i<this.buildingData.length;i++)if(this.buildingData[i].id==t)for(var n=this.buildingData[i],l=0;l<n.length;l++)if(n[l].id==e)return;this.listLoading=!0,this.getSingleRoomItemAllList(t,e,1,this.pageSize,a)},getSingleRoomItemAllList:function(t,e,a,i,n){var r=this;Object(o["c"])(e,a,i).then((function(a){var o=a.code,s=a.data;a.msg;if(0===o){var c,d=s.pageNum,u=s.pages,m=s.list,p=r.buildingData.find((function(e){return e.id==t})),f=p.children;f||(f=p.children=[]);var g=f.find((function(t){return t.id==e})),h=g.children;h||(h=[],r.$set(g,"children",h)),(c=h).push.apply(c,Object(l["a"])(m)),d<u?r.getSingleRoomItemAllList(t,e,d+1,i,n):(r.listLoading=!1,n(h),r.list=h)}}))},loadNode:function(t,e){0!==t.level?1!==t.level?2!==t.level||this.getRoomItemAllList(t.parent.data.id,t.data.id,e):this.getFloorItemAllList(t.data.id,e):this.getAllBuildingList(e)},fetchData:function(t){},handleUpdate:function(t){var e=this;this.updateItemData=t,this.temp=Object.assign({noteName:t.comment},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))},handleCreate:function(){var t=this;this.dialogStatus="create";var e=this.selectItem.type?this.selectItem.type+1:1;e>3&&(e=3),this.temp={id:this.selectItem.id,type:e},this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},handleSearch:function(){console.log(this.selectValue)},handleDelete:function(t,e){var a=this,i=t.id;Object(o["b"])(t.id).then((function(t){var n=t.code,l=(t.data,t.msg);if(0===n){a.$notify({title:"Success",message:"删除成功",type:"success",duration:3e3}),a.list.splice(e,1);var o=a.selectNode.childNodes.find((function(t){return console.log(t),t.data.id===i}));a.$refs.tree.remove(o)}else a.$notify.error(l)})).catch((function(t){a.$notify.error("删除失败!")}))},updateData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.dialogFormSobmitLoading=!0;var a=t.temp,i=a.id,n=a.name,l=a.noteName;Object(o["d"])(i,n,l).then((function(e){t.dialogFormSobmitLoading=!1;var a=e.code,i=(e.data,e.msg);0===a?(t.$notify({title:"Success",message:"更新成功",type:"success",duration:3e3}),Object.assign(t.updateItemData,{name:n,comment:l}),t.dialogFormVisible=!1):t.$notify.error(i)})).catch((function(e){t.$notify.error("更新失败!")}))}}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){t.dialogFormSobmitLoading=!0;var a=t.temp,i=a.id,n=a.name,l=a.noteName,r=a.type;Object(o["a"])(i,n,r,l).then((function(e){t.dialogFormSobmitLoading=!1;var a=e.code,i=e.data,n=e.msg;if(0===a)if(t.$notify({title:"Success",message:"创建成功",type:"success",duration:3e3}),t.selectItem.type>0){var l=t.selectItem.children;l||(l=[],t.$set(t.selectItem,"children",l)),l.push(i),t.$refs.tree.append(i,t.selectNode),t.list=l}else t.buildingData.push(i),t.list=t.buildingData.slice(1);else t.$notify.error(n);t.dialogFormVisible=!1})).catch((function(e){t.$notify.error("创建失败!")}))}}))}}},c=s,d=(a("6a46"),a("2877")),u=Object(d["a"])(c,i,n,!1,null,"08c4245b",null);e["default"]=u.exports},"6a46":function(t,e,a){"use strict";a("9452")},"7db0":function(t,e,a){"use strict";var i=a("23e7"),n=a("b727").find,l=a("44d2"),o=a("ae40"),r="find",s=!0,c=o(r);r in[]&&Array(1)[r]((function(){s=!1})),i({target:"Array",proto:!0,forced:s||!c},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),l(r)},9452:function(t,e,a){}}]);